name: Unit Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  unit-tests:
    name: Run Unit Tests
    runs-on: ubuntu-latest
    
    steps:
    # 1. Kod repository'sini klonla
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
    
    # 2. GCC kurulu geliyor ama build-essential ekleyelim
    - name: ğŸ”§ Install Build Tools
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential gcc make
    
    # 3. GCC versiyonunu gÃ¶ster
    - name: ğŸ“‹ Check Compiler Version
      run: |
        gcc --version
        make --version
    
    # 4. Unit testleri derle
    - name: ğŸ—ï¸ Build Unit Tests
      run: |
        echo "ğŸ”¨ Building unit tests..."
        cd tests
        make clean
        make build
        echo "âœ… Unit tests built successfully!"
    
    # 5. Testleri Ã§alÄ±ÅŸtÄ±r
    - name: ğŸ§ª Run Unit Tests
      run: |
        echo "ğŸš€ Running SKYRTOS unit tests..."
        cd tests
        make test
        echo "âœ… All tests completed!"
    
    # 6. Test sonuÃ§larÄ±nÄ± artifact olarak kaydet
    - name: ğŸ“¤ Upload Test Results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-results-${{ github.sha }}
        path: |
          tests/test_runner.exe
        retention-days: 7
    
    # 7. Test sonuÃ§larÄ±nÄ± gÃ¶ster
    - name: ğŸ“Š Display Test Summary
      if: always()
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ“Š SKYRTOS Unit Test Summary"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "âœ… Unit test execution completed!"
        echo "ğŸ“ Check the test output above for detailed results."
        echo "ğŸ“¦ Test artifacts uploaded for review."
        echo ""
